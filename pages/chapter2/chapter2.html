<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0>

    <title>Envelopes</title>

    <!-- CSS stylesheet(s) -->
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />

    <!-- Library script(s) -->
    <script src="../../js/libraries/p5.min.js"></script>
    <!-- <script src="js/libraries/p5.sound.min.js"></script> -->

    <!-- My script(s) -->
    <!-- <script src="js/script.js"></script> -->
    <script src="discontinuity01.js"></script>
    <script src="env_discont.js"></script>
  </head>
  <body>
    <h1>Unexpected Discontinuities</h1>
    <h2>Wait, what is a discontinuity?</h2>
    <p>Generally speaking, when you hear a click in your audio, that's a "discontinuity". We inherited the word from mathmaticians which is why it's such a mouthful. In audio we usually just call them clicks, but it's helpful to know the word discontinuity because it also sort of explains what it is.</p>
    <p><i>This ties back into envelopes I swear</i></p>
    <p>A discontinuity is a place where the audio wave isn't continuous (basically when it's not smooth). Here is an example (discontinuities are notated with the little blue arrows)</p>

    <div id="discont_01-container"></div>

    <p>Click the image to see a new discontinuity</p>
    <h2>Why does this happen?</h2>
    <p>A discontinuity (an audible click) happens whenever the amplitude of the wave changes abruptly. The bigger the change in amplitude, the louder the click. You can also see now why it's called a <b>discontinuity</b>, it's a visible cut in the smooth shape of the wave which makes the wave <b>not continuous</b></p>
    <h3>What does this have to do with envelopes?</h3>
    <p>Envelopes can create discontinuities in your sound (as you've probably heard before if you've ever tried to use Operator in Ableton to make your sub bass). Sine waves with a sharp amp env are the easiest place to catch this happening, but it is also happening in other wave shapes (but the sound can be masked by the other frequencies that wave is making/contains)</p>

    <div id="env_discont-container"></div>
    <div class="slider-container">
        <div class="slider">
            <input type="range" id="freq" min="4" max="60" value="20" class="slider-range">
            <label for="freq">Frequency</label>
        </div>
        <div class="slider">
            <input type="range" id="phase" min="0" max="100" value="25" class="slider-range">
            <label for="phase">Phase</label>
        </div>
        <div class="slider">
            <input type="range" id="envCurve" min="50" max="200" value="100" class="slider-range">
            <label for="envCurve">EnvCurve</label>
        </div>    
    </div>
    <div class="slider-container">
        <div class="slider">
            <input type="range" id="attack" min="0" max="100" value="50" class="slider-range">
            <label for="attack">Attack</label>
        </div>
        <div class="slider">
            <input type="range" id="decay" min="0" max="100" class="slider-range">
            <label for="decay">Decay</label>
        </div>
        <div class="slider">
            <input type="range" id="sustain" min="0" max="100" class="slider-range">
            <label for="sustain">Sustain</label>
        </div>
        <div class="slider">
            <input type="range" id="release" min="1" max="200" class="slider-range">
            <label for="release">Release</label>
        </div>
    </div>
    <p>Here you can see, depending on how you set the envelope settings, that your envelope can make discontinuities in the wave. Discontinuities are highlighted with the blue (teal?) arrows, like above.
    </p>
    <p>Also please note that the code I wrote for detecting the discontinuities is a bit over sensitive and you aren't likely to hear discontinuities at most places in the envelope other than where the slope of the envelope is straight up and down (usually at the beginning and end), but if you're hearing some unexpected ones you can come back here to remember where they <b>can</b> happen.</p>

    <h2>PHEWF</h2>
    <p>Alright, that's enough of that. Was that too much detail too soon? Maybe, but that's ok, let's keep truckin'. Envelopes can control a lot more than volume, they can control anything! The next chapter will explore some other stuff we can control.</p>

    </br>
    </br>
    <details>
        <summary>Want the gory details of why the algo is so sensitive?</summary>
        <p>I'm using a threshold on the third derivative to check how abruptly the waveform changes,unfortunately this is sort of an adhoc solution. If you increase the frequency of the wave the regular oscillations will also register as "discontinuities". I tried to scale the threshold with the frequency but it's... well, as you can see I'm not a math wiz so this was a bit above my paygrade. It was a pretty fun exercise for me though so I decided to keep it. I kind of got the feeling that if I kept taking the derivative, eventually I'd get a really nice solution but I got a bit tired of doing it haha. If you've got a better solution please submit a pull request!</p>
    </details>

    </br> 
    <h2>Onwards</h2> (this will be a link to the next page eventually)

    <br>
    <br>

  </body>
</html>